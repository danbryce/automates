<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width">
  <title>MathJax v3 with TeX input and MathML output</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <style>
  mjx-container[display="block"] {
    display: block;
    margin: 1em 0;
  }
  
  table {
    border-collapse: collapse;
  }
  
  table, th, td {
    border: 1px solid black;
  }
  </style>
  
  <script>
  MathJax = {
    //
    //  Load only TeX input and the contextual menu
    //
    loader: {load: ['input/tex', 'ui/menu']},
    //
    startup: {
      ready() {
        MathJax.startup.defaultReady();
        MathJax.startup.document.menu.menu.findID('Accessibility', 'AssistiveMml').disable();
      },
      pageReady() {
        MathJax._.mathjax.mathjax.handleRetriesFor(() => {
          MathJax.startup.document.render();
        });
      }
    },
    //
    //  Use dollar signs for in-line delimiters in addition to the usual ones
    //
    tex: {inlineMath: {'[+]': [['$', '$']]}},
    //
    //  Override the usual typeset render action with one that generates MathML output
    //
    options: {
      menuOptions: {
        settings: {
          assistiveMml: false
        }
      },
      renderActions: {
        typeset: [150,
          //
          //  The function for rendering a document's math elements
          //
          (doc) => {
          
            let i = 0;
            for (math of doc.math) {
            
              latex_src_elm = document.getElementById(`tex_src_${i}`);
              latex_src_string = latex_src_elm.textContent;

              // extract just the src, not the enclosing mathjax latex indicators
              latex_src = latex_src_string.substring(2, latex_src_string.length-2);

              // console.log(latex_src_elm);
              // console.log(latex_src);
            
              mml = MathJax.startup.toMML(math.root);
              
              mml_img = document.getElementById(`mml_img_${i}`);
              mml_img.innerHTML = mml;
              
              mml_src = document.getElementById(`mml_src_${i}`);
              mml_src.textContent = mml;
            
              // console.log(latex_src_elm);
              
              // The commented line 86 restores the latex src text to the elm
              // However, results in the following error:
              //     TypeError: this.parent(...) is null - in core.js:1:59028
              //latex_src_elm.textContent = latex_src;
              
              latex_src_elm.appendChild(document.createTextNode(latex_src));
            
              // The next line is from the original mathjax web demo script
              //     if remove next line, get the following error:
              //        TypeError: t is null - in menu.js:1:24458
              //     if keep next line, will remove the latex source in the first table cell
              math.typesetRoot = document.createElement('mjx-container');
              
              // from original mathjax web demo script
              // math.typesetRoot.innerHTML = mml;
              // math.display && math.typesetRoot.setAttribute('display', 'block');
              
              console.log(i);
              
              i++;
            }
            
          }
          
        ]
      }
    }
  };
  </script>
  
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>

</head>
<body>
  <table>
    <thead>
      <tr><th width=400>LaTeX</th><th>Equation</th><th width=500>MathML</th></tr>
    </thead>
  </table>
</body>

<script>

let latex_source = [
  { src: "P(E) = {n \\choose k} p^k (1-p)^{ n-k}" },
  { src: "\\begin{align} \\dot{x} \& = \\sigma(y-x) \\\\ \\dot{y} \& = \\rho x - y - xz \\\\ \\dot{z} \& = -\\beta z + xy \\end{align}" },
  { src: "\\left( \\sum_{k=1}^n a_k b_k \\right)^{\\!\\!2} \\leq \\left( \\sum_{k=1}^n a_k^2 \\right) \\left( \\sum_{k=1}^n b_k^2 \\right)" },
  { src: "\\mathbf{V}_1 \\times \\mathbf{V}_2 = \\begin{vmatrix} \\mathbf{i} \& \\mathbf{j} \& \\mathbf{k} \\\\ \\frac{\\partial X}{\\partial u} \& \\frac{\\partial Y}{\\partial u} \& 0 \\\\ \\frac{\\partial X}{\\partial v} \& \\frac{\\partial Y}{\\partial v} \& 0 \\\\ \\end{vmatrix}" }
  // { src: "\\mathbf{V}_1 \\times \\mathbf{V}_2 = " },
  // { src: "\\begin{vmatrix} \\mathbf{i} \& \\mathbf{j} \& \\mathbf{k} \\\\ \\frac{\\partial X}{\\partial u} \& \\frac{\\partial Y}{\\partial u} \& 0 \\\\ \\frac{\\partial X}{\\partial v} \& \\frac{\\partial Y}{\\partial v} \& 0 \\\\ \\end{vmatrix}" }
];

function generateTable(table, data) {
  let i = 0;
  for (let element of data) {
    let row = table.insertRow();
    
    let cell = row.insertCell();
    cell.id = `tex_src_${i}`;
    let text = document.createTextNode(`\\[ ${element["src"]} \\]`);
    cell.appendChild(text);
    
    cell = row.insertCell();
    cell.id = `mml_img_${i}`;
    text = document.createTextNode(`${cell.id} IMAGE`);
    cell.appendChild(text);
    
    cell = row.insertCell();
    cell.id = `mml_src_${i}`;
    text = document.createTextNode(`${cell.id} SOURCE`);
    cell.appendChild(text);
    
    i++;
  }
}

let table = document.querySelector("table");
generateTable(table, latex_source);

</script>

</html>